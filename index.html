<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador Cr√©dito Habita√ß√£o 2026</title>
  <style>
    :root { --primary: #1a2a6c; --secondary: #00a8ff; --success: #27ae60; --danger: #e84118; --bg: #f4f7f9; }
    body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: #2f3640; margin: 0; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    .card { background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
    h2 { font-size: 1.1rem; color: var(--primary); border-bottom: 2px solid #edf2f7; padding-bottom: 10px; margin-bottom: 20px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
    label { display: block; font-weight: 600; margin-bottom: 5px; font-size: 0.85rem; }
    input { width: 100%; padding: 12px; border: 1px solid #dcdde1; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
    .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .btn-max { background: var(--success); color: white; }
    .btn-main { background: var(--primary); color: white; }
    .btn-email { background: #444; color: white; }
    .result-area { margin-top: 20px; padding: 20px; background: #f8fafc; border-radius: 10px; border-left: 5px solid var(--primary); display: none; }
    .res-line { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e2e8f0; }
    .highlight { font-size: 1.4rem; font-weight: 900; color: var(--primary); }
    .jovem-box { background: #e3f2fd; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; margin: 15px 0; border: 1px solid #bbdefb; }
    .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--secondary); }
    input:checked + .slider:before { transform: translateX(22px); }
    /* MODAL */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .modal-content { background: white; padding: 40px; border-radius: 20px; text-align: center; max-width: 500px; width: 90%; }
    .modal-value { font-size: 2.5rem; font-weight: 900; color: var(--success); margin: 15px 0; display: block; }
    .btn-close { background: var(--primary); color: white; padding: 12px 30px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>

<div class="container">
  <h1 style="text-align:center; color: var(--primary);">Simulador Cr√©dito Imobili√°rio 2026</h1>

  <div class="card">
    <h2>1. Rendimento e Financiamento M√°ximo</h2>
    <div class="grid">
      <div class="form-group"><label>Rendimento L√≠quido Mensal (‚Ç¨)</label><input type="text" id="rend" value="2.500" oninput="fInput(this)"></div>
      <div class="form-group"><label>Outras Presta√ß√µes (‚Ç¨)</label><input type="text" id="outras" value="0" oninput="fInput(this)"></div>
      <div class="form-group"><label>TAN Juro (%)</label><input type="number" id="tan" value="3.5" step="0.01"></div>
      <div class="form-group"><label>Prazo (Anos)</label><input type="number" id="anos" value="35"></div>
    </div>
    <button class="btn btn-max" onclick="calcMax()">üìà Calcular Financiamento M√°ximo</button>
  </div>

  <div class="card">
    <h2>2. Detalhes da Compra</h2>
    <div class="grid">
      <div class="form-group"><label>Valor de Compra (‚Ç¨)</label><input type="text" id="v_compra" value="250.000" oninput="fInput(this)"></div>
      <div class="form-group"><label>Valor do Empr√©stimo (‚Ç¨)</label><input type="text" id="v_finan" value="225.000" oninput="fInput(this)"></div>
    </div>
    <div class="jovem-box">
      <div><strong>Benef√≠cio Jovem (Isen√ß√£o IMT/Selo)</strong></div>
      <label class="switch"><input type="checkbox" id="is_jovem"><span class="slider"></span></label>
    </div>
    <button class="btn btn-main" onclick="simular()">üìä Simular Custos Totais</button>
    <button class="btn btn-email" onclick="enviarEmail()">‚úâÔ∏è Enviar Simula√ß√£o por Email</button>
  </div>

  <div id="res" class="result-area card">
    <div class="res-line"><span>Presta√ß√£o Mensal:</span> <span id="rP" class="highlight"></span></div>
    <div class="res-line"><span>IMT + Imposto Selo Compra:</span> <span id="rI"></span></div>
    <div class="res-line"><span>Imposto Selo Cr√©dito (0.6%):</span> <span id="rSC"></span></div>
    <div class="res-line"><span>Escritura e Registos (est.):</span> <span id="rE">1.200,00 ‚Ç¨</span></div>
    <div class="res-line" style="border:none; margin-top:15px; background: #fff3cd; padding:15px; border-radius:8px;">
      <strong>Dinheiro Total Necess√°rio (Entrada + Custos):</strong>
      <strong id="rT" style="color:var(--danger); font-size:1.4rem;"></strong>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modalOverlay">
  <div class="modal-content">
    <div style="font-size:1.2rem; color:#666;">Financiamento M√°ximo Sugerido</div>
    <div class="modal-value" id="modalValue">0,00 ‚Ç¨</div>
    <button class="btn-close" onclick="closeModal()">FECHAR</button>
  </div>
</div>

<script>
  const fmt = v => v.toLocaleString('pt-PT', { style: 'currency', currency: 'EUR' });
  const pV = s => parseFloat(s.toString().replace(/[^\d]/g, '')) || 0;
  function fInput(i) { let v = i.value.replace(/\D/g, ""); if(v) i.value = new Intl.NumberFormat('pt-PT').format(v); }

  function getPrestacao(capital, tanAnual, anos) {
    const i = (tanAnual / 100) / 12;
    const n = anos * 12;
    return capital * (i / (1 - Math.pow(1 + i, -n)));
  }

  function openModal(valor) { document.getElementById('modalValue').innerText = fmt(valor); document.getElementById('modalOverlay').style.display = 'flex'; }
  function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }

  function calcMax() {
    const r = pV(document.getElementById('rend').value), o = pV(document.getElementById('outras').value);
    const t = parseFloat(document.getElementById('tan').value), a = parseInt(document.getElementById('anos').value);
    const pMax = (r * 0.5) - o, iS = ((t + 1.5) / 100) / 12, n = a * 12;
    const cMax = pMax * (1 - Math.pow(1 + iS, -n)) / iS;
    document.getElementById('v_finan').value = new Intl.NumberFormat('pt-PT').format(Math.floor(cMax));
    openModal(cMax);
  }

  function simular() {
    const vc = pV(document.getElementById('v_compra').value), vf = pV(document.getElementById('v_finan').value);
    const t = parseFloat(document.getElementById('tan').value), a = parseInt(document.getElementById('anos').value);
    const isJ = document.getElementById('is_jovem').checked;

    const prest = getPrestacao(vf, t, a);
    let tx, par;
    if (vc <= 101917) { tx = 0; par = 0; }
    else if (vc <= 139412) { tx = 0.02; par = 2038.34; }
    else if (vc <= 190086) { tx = 0.05; par = 6220.70; }
    else if (vc <= 316772) { tx = 0.07; par = 10022.42; }
    else if (vc <= 633453) { tx = 0.08; par = 13190.14; }
    else { tx = 0.075; par = 0; }

    let imt = Math.max(0, (vc * tx) - par), sC = vc * 0.008;
    if (isJ) { 
        if (vc <= 316772) { imt = 0; sC = 0; } 
        else if (vc <= 633453) { imt -= ((316772 * 0.07) - 10022.42); sC -= (316772 * 0.008); }
    }
    const sF = vf * 0.006, total = (vc - vf) + imt + sC + sF + 1200;

    document.getElementById('res').style.display = 'block';
    document.getElementById('rP').innerText = fmt(prest);
    document.getElementById('rI').innerText = fmt(imt + sC);
    document.getElementById('rSC').innerText = fmt(sF);
    document.getElementById('rT').innerText = fmt(total);
  }

  function enviarEmail() {
    const vF = document.getElementById('v_finan').value, vC = document.getElementById('v_compra').value;
    const pz = document.getElementById('anos').value, pM = document.getElementById('rP').innerText;
    const iS = document.getElementById('rI').innerText, sC = document.getElementById('rSC').innerText;
    const esc = document.getElementById('rE').innerText, tot = document.getElementById('rT').innerText;

    if (!pM) { alert("Simule primeiro para gerar os dados."); return; }

    const subject = encodeURIComponent("Resumo de Simula√ß√£o Cr√©dito Habita√ß√£o");
    const body = encodeURIComponent(
      "RESUMO DA SIMULA√á√ÉO\n" +
      "-------------------------------------------\n" +
      "Valor financiamento: " + vF + " ‚Ç¨\n" +
      "Valor compra: " + vC + " ‚Ç¨\n" +
      "Prazo: " + pz + " anos\n" +
      "Presta√ß√£o mensal: " + pM + "\n\n" +
      "IMT + Imposto Selo Compra: " + iS + "\n" +
      "Imposto Selo Cr√©dito (0.6%): " + sC + "\n" +
      "Escritura e Registos: " + esc + "\n\n" +
      "Dinheiro Total Necess√°rio (Entrada + Custos):\n" + tot + "\n" +
      "-------------------------------------------"
    );
    window.location.href = `mailto:?subject=${subject}&body=${body}`;
  }
</script>
 <!-- Cloudflare Web Analytics -->
<script defer src="https://static.cloudflareinsights.com/beacon.min.js"
        data-cf-beacon='{"token": "0dc1371ec59643bfb902deb464cfcb8a"}'>
</script>
<!-- End Cloudflare Web Analytics -->

</body>
</html>

